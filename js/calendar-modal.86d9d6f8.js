"use strict";(self["webpackChunkvue_front"]=self["webpackChunkvue_front"]||[]).push([[945],{6197:function(e,t,n){n.d(t,{Z:function(){return u}});var a=n(3396),i=n(7139),s=n(9242);const o={key:0,class:"app-input-caption"},l={class:"app-input-holder"},r=["value","type","disabled","placeholder","readonly","maxLength","min","max","step"];function c(e,t,n,c,d,m){return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["app-input",e.rootClasses])},[e.caption?((0,a.wg)(),(0,a.iD)("div",o,(0,i.zw)(e.caption),1)):(0,a.kq)("",!0),(0,a.WI)(e.$slots,"left"),(0,a._)("div",l,[(0,a._)("input",{class:"app-input-input",onFocus:t[0]||(t[0]=(...t)=>e.focusHandler&&e.focusHandler(...t)),onInput:t[1]||(t[1]=(...t)=>e.inputHandler&&e.inputHandler(...t)),onKeyup:[t[2]||(t[2]=(0,s.D2)(((...t)=>e.enterHandler&&e.enterHandler(...t)),["enter"])),t[3]||(t[3]=(0,s.D2)(((...t)=>e.escapeHandler&&e.escapeHandler(...t)),["escape"]))],value:e.localValue,type:e.type,disabled:e.disabled,placeholder:e.placeholder,readonly:e.readonly,maxLength:e.maxLength,min:e.min,max:e.max,step:e.step,spellcheck:"false",autocomplete:"off",ref:"input"},null,40,r),(0,a.WI)(e.$slots,"input-after")]),(0,a.Wm)(s.uT,{name:"clear"},{default:(0,a.w5)((()=>[e.clearable&&e.localValue?((0,a.wg)(),(0,a.iD)("span",{key:0,class:"app-input-clear",onClick:t[4]||(t[4]=t=>e.$emit("clear"))},"× ")):(0,a.kq)("",!0)])),_:1}),(0,a.WI)(e.$slots,"right")],2)}var d=(0,a.aZ)({name:"AppInput",props:{type:{type:String,default:"text"},modelValue:{type:[String,Number],default:""},value:{type:[String,Number],default:""},state:{type:String,default:""},validator:{type:Function},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},caption:{type:String},placeholder:{type:String},readonly:{type:Boolean,default:!1},maxLength:{type:Number},min:{type:[String,Number]},max:{type:[String,Number]},step:{type:[String,Number]}},emits:["update:modelValue","update:state","focus","clear","enter","blur","input","escape"],data(){return{localValue:this.modelValue||this.value,localState:this.state}},watch:{value(e,t){e!==t&&(this.setValue(e),this.validate())},modelValue(e,t){e!==t&&(this.setValue(e),this.validate())},state(e,t){e!==t&&this.setState(e)}},computed:{input(){return this.$refs.input},rootClasses(){return this.readonly||this.disabled?[]:[this.localState]}},methods:{enterHandler(e){"invalid"!==this.state&&(this.emitInputEvent("enter",e),this.blur())},inputHandler(e){const{value:t}=e.target;this.setValue(t),this.emitInputEvent("input",e)},focusHandler(e){this.validate(),this.emitInputEvent("focus",e)},escapeHandler(e){this.emitInputEvent("escape",e),this.blur()},emitInputEvent(e,t){const n=this.getInputEventData(),a={name:e,event:t,...n};this.$emit(e,a)},getInputEventData(){const e={value:this.localValue,state:this.localState};return e},validate(){if(this.validator){const{valid:e,message:t=""}=this.validator(this.localValue);this.setState(e?"valid":"invalid"),this.input.setCustomValidity(t),t&&this.input.reportValidity()}},setState(e){this.localState!==e&&(this.localState=e,this.$emit("update:state",e))},setValue(e){e="number"===this.type?Number(e):e,this.localValue!==e&&(this.localValue=e,this.$emit("update:modelValue",e))},focus(){try{this.input.focus()}catch(e){console.log(e)}},blur(){try{this.input.blur()}catch(e){console.log(e)}}}}),m=n(89);const p=(0,m.Z)(d,[["render",c]]);var u=p},7311:function(e,t,n){n.d(t,{Z:function(){return b}});var a=n(3396),i=n(7139),s=n(9242);const o={class:"app-select-input-head"},l=(0,a._)("div",{class:"app-select-arrow-vertical"},null,-1),r={class:"app-select-input-body"},c={key:0,class:"app-select-input-items custom-scroll"},d=["onClick"],m={key:1,class:"app-select-input-info"},p={key:0},u=(0,a._)("b",null,"Cкрыто:",-1),h={key:1},g=(0,a._)("b",null,"Всего:",-1);function y(e,t,n,y,f,v){const w=(0,a.up)("app-bar-loader"),k=(0,a.up)("app-input"),C=(0,a.Q2)("click-outside");return(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["app-select-input",[e.mode,{open:e.open}]])},[(0,a._)("div",o,[(0,a.WI)(e.$slots,"head",{item:e.itemLocal,headClickHandler:e.headClickHandler},(()=>[(0,a.Wm)(k,{onFocus:e.focusHandler,onInput:e.inputHandler,onEscape:t[0]||(t[0]=t=>e.toggle(!1)),caption:e.caption,value:e.itemLocal.text,placeholder:e.placeholder},(0,a.Nv)({_:2},[e.dropArrow?{name:"input-after",fn:(0,a.w5)((()=>[l,e.loading?((0,a.wg)(),(0,a.j4)(w,{key:0})):(0,a.kq)("",!0)]))}:void 0]),1032,["onFocus","onInput","caption","value","placeholder"])])),(0,a.WI)(e.$slots,"head-right",{item:e.itemLocal})]),(0,a._)("div",r,[(0,a.Wm)(s.W3,{name:"select"},{default:(0,a.w5)((()=>[e.open&&e.itemsComputed.length?((0,a.wg)(),(0,a.iD)("div",c,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.itemsComputed,((t,n)=>(0,a.WI)(e.$slots,"body",{key:n,item:t,index:n,itemClickHandler:e.itemClickHandler},(()=>[(0,a._)("div",{class:"app-select-input-item",onClick:n=>e.itemClickHandler(t)},[(0,a._)("span",null,(0,i.zw)(t.text),1),(0,a.WI)(e.$slots,"item-right",{item:t})],8,d)])))),128))])):(0,a.kq)("",!0),e.open&&e.footer&&!e.loading?((0,a.wg)(),(0,a.iD)("div",m,[e.limit?((0,a.wg)(),(0,a.iD)("span",p,[u,(0,a.Uk)(" "+(0,i.zw)(e.itemsLocal.length-e.itemsComputed.length)+" шт.",1)])):((0,a.wg)(),(0,a.iD)("span",h,[g,(0,a.Uk)(" "+(0,i.zw)(e.itemsLocal.length)+" шт.",1)]))])):(0,a.kq)("",!0)])),_:3})])],2)),[[C,()=>e.toggle(!1)]])}n(1703);var f=n(6197);function v(e,t=50,n={}){let a;const i=n.isImmediate??!1,s=n.callback??!1,o=n.maxWait;let l=Date.now(),r=[];function c(){if(void 0!==o){const e=Date.now()-l;if(e+t>=o)return o-e}return t}const d=function(...t){const n=this;return new Promise(((o,d)=>{const m=function(){if(a=void 0,l=Date.now(),!i){const a=e.apply(n,t);s&&s(a),r.forEach((({resolve:e})=>e(a))),r=[]}},p=i&&void 0===a;if(void 0!==a&&clearTimeout(a),a=setTimeout(m,c()),p){const a=e.apply(n,t);return s&&s(a),o(a)}r.push({resolve:o,reject:d})}))};return d.cancel=function(e){void 0!==a&&clearTimeout(a),r.forEach((({reject:t})=>t(e))),r=[]},d}var w=(0,a.aZ)({name:"AppSelectInput",components:{AppInput:f.Z},props:{caption:{type:String},modelValue:{type:Object,default:()=>({text:""})},items:{type:[Array,Function],default:()=>[]},limit:{type:Number,default:0,validator:e=>"number"===typeof e},itemsGetter:{type:Function},mode:{type:String,default:"search"},footer:{type:Boolean,default:!1},placeholder:{type:String,default:"Choose"},dropArrow:{type:Boolean,default:!0}},emits:["update:modelValue","changed","selected"],data(){return{itemLocal:this.modelValue,itemsLocal:[],searchKey:"",open:!1,loading:!1,loadItemsDebounced:void 0}},watch:{modelValue:{handler(e){this.itemLocal!==e&&(this.itemLocal=e)},immediate:!0},items:{handler(e){Array.isArray(e)?this.itemsLocal=[...e]:"function"===typeof e&&(this.loadItemsDebounced=v(e,1e3))},immediate:!0}},computed:{itemsComputed(){const e=Number(this.limit)||this.itemsLocal.length;let t=[];if("select"===this.mode)t=this.itemsLocal;else if("search"===this.mode){const e=this.searchKey.toLowerCase();t=this.itemsLocal.filter((t=>String(t.text).toLowerCase().includes(e))),t.sort(((t,n)=>{const a=String(t.text).toLowerCase().startsWith(e),i=String(n.text).toLowerCase().startsWith(e);return a&&i?0:a?-1:1}))}return t.slice(0,e)}},methods:{headClickHandler(){this.$slots.head&&(this.open?this.toggle(!1):(this.toggle(!0),this.loadItems()))},focusHandler(e){if("select"===this.mode){const t=e.event;t.target&&t.target.blur(),this.toggle()}else"search"===this.mode&&(this.searchKey=String(e.value),this.open||this.toggle(!0));this.loadItems()},inputHandler(e){this.searchKey=String(e.value),this.loadItems()},itemClickHandler(e){this.setItem(e)},async loadItems(e){try{if(this.isLoadNeeded(this.items)){const{value:t=this.searchKey,limit:n=this.limit}=e||{};if(!this.loadItemsDebounced)throw new Error("noLoadItemsDebounced");this.itemsLocal.length=0,this.loading=!0;const a=await this.loadItemsDebounced({value:t,limit:n});this.loading=!1,this.itemsLocal=[...a]}}catch(t){if(this.loading=!1,!t)return;throw t}},isLoadNeeded(e){return"function"===typeof this.items},setItem(e){const t=this.itemsComputed.findIndex((t=>t===e));this.$emit("selected",{item:e,index:t}),this.itemLocal!==e&&(this.itemLocal=e,this.$emit("update:modelValue",e),this.$emit("changed",{item:e,index:t})),this.toggle(!1)},toggle(e){this.open="boolean"===typeof e?e:!this.open,this.open||(this.loadItemsDebounced&&this.loadItemsDebounced.cancel(),this.loading=!1)}}}),k=n(89);const C=(0,k.Z)(w,[["render",y]]);var b=C},7962:function(e,t,n){n.r(t),n.d(t,{default:function(){return te}});var a=n(3396);const i={id:"calendar-modal",class:"app-modal-container"},s={class:"app-modal-header"},o=(0,a.Uk)(" header "),l={id:"calendar-modal-body",class:"app-modal-body custom-scroll"},r=(0,a._)("div",{class:"app-modal-footer"}," footer ",-1);function c(e,t,n,c,d,m){const p=(0,a.up)("app-icon"),u=(0,a.up)("app-calendar"),h=(0,a.up)("custom-keypress");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",i,[(0,a._)("div",s,[o,(0,a.Wm)(p,{class:"app-modal-close",icon:"close",onClick:e.closeHandler},null,8,["onClick"])]),(0,a._)("div",l,[(0,a.Wm)(u,{ref:"calendar",targetTimestamp:e.targetTimestamp,currentTimestamp:e.currentTimestamp,years:e.years,selections:e.selections,onDayClick:t[0]||(t[0]=t=>e.$emit("day-click",t)),onYearChanged:t[1]||(t[1]=t=>e.$emit("year-changed",t)),onMonthChanged:t[2]||(t[2]=t=>e.$emit("month-changed",t)),onYearSelectionClick:t[3]||(t[3]=t=>e.$emit("year-selection-click",t)),onMonthSelectionClick:t[4]||(t[4]=t=>e.$emit("month-selection-click",t))},null,8,["targetTimestamp","currentTimestamp","years","selections"])]),r]),(0,a.Wm)(h,{"key-event":"keyup",keyCode:27,onSuccess:e.closeHandler},null,8,["onSuccess"])],64)}var d=n(7139);const m={class:"app-calendar"},p={class:"app-calendar-head"},u={class:"app-calendar-head-row"},h={class:"app-calendar-head-row"},g=["cell"],y={class:"app-calendar-head-cell-content"},f={class:"app-calendar-body"},v=["onClick"],w={class:"app-calendar-body-cell-day"};function k(e,t,n,i,s,o){const l=(0,a.up)("app-calendar-controls");return(0,a.wg)(),(0,a.iD)("div",m,[(0,a._)("div",p,[(0,a._)("div",u,[(0,a.Wm)(l,{timestamp:e.targetTimestamp,selections:e.selections,onYearChanged:t[0]||(t[0]=t=>e.$emit("year-changed",t)),onMonthChanged:t[1]||(t[1]=t=>e.$emit("month-changed",t)),onYearSelectionClick:t[2]||(t[2]=t=>e.$emit("year-selection-click",t)),onMonthSelectionClick:t[3]||(t[3]=t=>e.$emit("month-selection-click",t)),onHome:t[4]||(t[4]=t=>e.$emit("home")),onClear:t[5]||(t[5]=t=>e.$emit("clear"))},null,8,["timestamp","selections"])]),(0,a._)("div",h,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.getHeaderCells(e.shortDays),(e=>((0,a.wg)(),(0,a.iD)("div",{class:"app-calendar-head-cell",key:e,cell:e},[(0,a._)("div",y,(0,d.zw)(e.text),1)],8,g)))),128))])]),(0,a._)("div",f,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.getBodyRows(e.targetTimestamp,e.currentTimestamp,e.selections),(t=>((0,a.wg)(),(0,a.iD)("div",{class:"app-calendar-body-row",key:t},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.getBodyCells(t),(t=>((0,a.wg)(),(0,a.iD)("div",{class:(0,d.C_)(["app-calendar-body-cell",[{disabled:t.disabled,selected:t.selected,today:t.today,offset:t.offset},t.belongsToMonth]]),key:t.timestamp},[(0,a._)("div",{class:"app-calendar-body-cell-content",onClick:n=>e.$emit("day-click",{cell:t})},[(0,a.WI)(e.$slots,"body-cell",{cell:t},(()=>[(0,a._)("span",w,(0,d.zw)(t.day),1)]))],8,v)],2)))),128))])))),128))])])}n(1703);function C({month:e,year:t}){if(t&&"number"===typeof e)return new Date(t,e+1,0).getDate();throw new Error("missingParams")}function b(e){const t=new Date(e);return{year:t.getFullYear(),month:t.getMonth(),day:t.getDate()}}function D({month:e,year:t}){const n=C({month:e,year:t}),a=I({month:e,year:t}),i=Math.ceil((n+a)/7);return i}function I({month:e,year:t}){if(t&&"number"===typeof e){const n=new Date(t,e,1).getDay();return H(n)}throw new Error("missingParams")}function H(e){return e-=1,e<0?6:e}function S({year:e,month:t,day:n}){if(e&&"number"===typeof t&&"number"===typeof n)return new Date(e,t,n).getTime();throw new Error("missingParams")}function $(e){return new Date(new Date(e).getFullYear(),0,1).getTime()}function _(e){return new Date(new Date(e).getFullYear(),new Date(e).getMonth(),1).getTime()}function x(){return 864e5}const T=[];function V(e,t,n){e=e||t;const{year:a,month:i}=b(e),s=D({year:a,month:i});return W({rows:s,year:a,month:i,currentTimestamp:t,selections:n}),s}function L(e){e--;const t=[];for(let n=0;n<7;n++)t.push(T[n+7*e]);return t}function W({rows:e,month:t,year:n,currentTimestamp:a,selections:i}){T.length=0;const s=7*e,o=I({month:t,year:n}),l=C({month:t,year:n}),r=C({month:t-1,year:n}),c=S({month:t,year:n,day:1}),d=x(),m=S(b(a));for(let h=o;h>0;h--){const e=c-d*h;T.push({day:r-(h-1),belongsToMonth:"previous",timestamp:e,currentTimestamp:a,today:e===m,selected:!!i[e]})}for(let h=1;h<=l;h++){const e=c+d*(h-1);T.push({day:h,belongsToMonth:"current",timestamp:e,currentTimestamp:a,today:e===m,selected:!!i[e]})}const p=s-T.length,u=c+l*d;for(let h=1;h<=p;h++){const e=u+d*(h-1);T.push({day:h,belongsToMonth:"next",timestamp:e,currentTimestamp:a,today:e===m,selected:!!i[e]})}}function M(e){return e.map((e=>({text:e})))}const E=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],Y=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];var A=n(9242);const N={id:"app-calendar-controls"},Z={id:"app-calendar-controls-right"},F=["onClick"],q=["onClick"],z=["onClick"],K=["onClick"];function j(e,t,n,i,s,o){const l=(0,a.up)("app-button"),r=(0,a.up)("app-select-input");return(0,a.wg)(),(0,a.iD)("div",N,[(0,a.Wm)(r,{dropArrow:!1,items:e.settingsItems,position:"right",onSelected:e.settingsSelectedHandler},{head:(0,a.w5)((({item:e,headClickHandler:t})=>[(0,a.Wm)(l,{icon:"cog",onClick:n=>t(e)},null,8,["onClick"])])),body:(0,a.w5)((({item:e,itemClickHandler:t})=>[(0,a.Wm)(l,{class:"app-calendar-settings-item",onClick:n=>t(e),text:e.text,icon:e.icon},null,8,["onClick","text","icon"])])),_:1},8,["items","onSelected"]),(0,a._)("div",Z,[(0,a.Wm)(r,{mode:"select",items:e.years,modelValue:e.year,"onUpdate:modelValue":t[0]||(t[0]=t=>e.year=t),dropArrow:"",onChanged:e.yearChangedHandler},{"head-right":(0,a.w5)((({item:t})=>[t.selections?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"app-calendar-control-counter",onClick:(0,A.iM)((n=>e.$emit("year-selection-click",{item:t})),["stop"])},[(0,a._)("span",null,(0,d.zw)(t.selections),1)],8,F)):(0,a.kq)("",!0)])),"item-right":(0,a.w5)((({item:t})=>[t.selections?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"app-calendar-control-counter",onClick:(0,A.iM)((n=>e.$emit("year-selection-click",{item:t})),["stop"])},[(0,a._)("span",null,(0,d.zw)(t.selections),1)],8,q)):(0,a.kq)("",!0)])),_:1},8,["items","modelValue","onChanged"]),(0,a.Wm)(r,{mode:"select",items:e.months,modelValue:e.month,"onUpdate:modelValue":t[1]||(t[1]=t=>e.month=t),dropArrow:"",onChanged:e.monthChangedHandler},{"head-right":(0,a.w5)((({item:t})=>[t.selections?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"app-calendar-control-counter",onClick:(0,A.iM)((n=>e.$emit("month-selection-click",{item:t})),["stop"])},[(0,a._)("span",null,(0,d.zw)(t.selections),1)],8,z)):(0,a.kq)("",!0)])),"item-right":(0,a.w5)((({item:t})=>[t.selections?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"app-calendar-control-counter",onClick:(0,A.iM)((n=>e.$emit("month-selection-click",{item:t})),["stop"])},[(0,a._)("span",null,(0,d.zw)(t.selections),1)],8,K)):(0,a.kq)("",!0)])),_:1},8,["items","modelValue","onChanged"])])])}var B=n(7311),O=(0,a.aZ)({name:"AppCalendarControls",components:{AppSelectInput:B.Z},props:{timestamp:{type:Number,required:!0},selections:{type:Object,default:()=>({})}},emits:["home","year-changed","month-changed","year-selection-click","month-selection-click","clear"],data(){return{settingsItems:[{text:"Вернуться к началу",icon:"home",id:"home"},{text:"Удалить выделенное",icon:"bin",id:"clear"}],...this.getInitData(this.selections,this.timestamp)}},watch:{timestamp(){Object.assign(this,this.getInitData(this.selections,this.timestamp))},selections:{handler(){Object.assign(this,this.getInitData(this.selections,this.timestamp))},deep:!0}},methods:{yearChangedHandler({index:e}){this.year=this.years[e];const t=this.createChangedEvent();this.$emit("year-changed",t)},monthChangedHandler({index:e}){this.month=this.months[e];const t=this.createChangedEvent();this.$emit("month-changed",t)},settingsSelectedHandler({item:e}){"home"===e.id?this.$emit("home"):"clear"===e.id&&this.$emit("clear")},getInitData(e,t){const n=this.getSelections(e),a=this.getYears(n.years),i=this.getMonths(n.months),{year:s,month:o}=this.getYearAndMonth(a,i,t);return{years:a,months:i,year:s,month:o}},getSelections(e){const t={years:{},months:{}};for(const n in e){const e=$(Number(n)),a=_(Number(n));t.years[e]=t.years[e]||0,t.months[a]=t.months[a]||0,t.years[e]+=1,t.months[a]+=1}return t},getYears(e){const t=[new Date(this.timestamp).getFullYear()];return t.map(((t,n)=>{const a=new Date(t,0,1).getTime();return{value:t,text:String(t),timestamp:a,index:n,selections:e[a]||0}}))},getMonths(e){const t=new Date(this.timestamp).getFullYear();return E.map(((n,a)=>{const i=new Date(t,a,1).getTime();return{value:a,text:n,timestamp:i,index:a,selections:e[i]||0}}))},createChangedEvent(){if(!this.year)throw new Error("noYearInCreateChangedEvent");if(!this.month)throw new Error("noMonthInCreateChangedEvent");const e=new Date(this.year.value,this.month.value,1).getTime();return{timestamp:e}},getYearAndMonth(e,t,n){const a=new Date(n),i=a.getFullYear(),s=a.getMonth(),o=e.find((({value:e})=>e===i)),l=t[s];return{year:o,month:l}}}}),U=n(89);const P=(0,U.Z)(O,[["render",j]]);var R=P,G=(0,a.aZ)({name:"AppCalendar",components:{AppCalendarControls:R},props:{targetTimestamp:{type:Number,default:Date.now()},currentTimestamp:{type:Number,default:Date.now()},selections:{type:Object,default:()=>({})}},emits:["day-click","month-changed","year-changed","year-selection-click","month-selection-click","home","clear"],setup(){return{getBodyRows:V,getBodyCells:L,getHeaderCells:M,shortDays:Y}}});const Q=(0,U.Z)(G,[["render",k]]);var J=Q,X=(0,a.aZ)({name:"CalendarModal",components:{AppCalendar:J},emits:["close","day-click","year-changed","month-changed","year-selection-click","month-selection-click"],props:{targetTimestamp:{type:Number,default:Date.now()},currentTimestamp:{type:Number,default:Date.now()},years:{type:Array,default:()=>[(new Date).getFullYear()]},selections:{type:Object,default:()=>({})}},methods:{closeHandler(){this.$emit("close")}}});const ee=(0,U.Z)(X,[["render",c]]);var te=ee}}]);